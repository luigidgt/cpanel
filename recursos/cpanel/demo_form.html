<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IDXBoost | Welcome</title>
    <meta name="keywords" content="FlexIdx, listing, Filters, Analytics">
    <meta name="description" content="FlexIdx, the best dashboard admin listing, Filters, Analytics">

    <link rel="stylesheet" type="text/css" href="../../css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
    <link id="page_favicon" type="image/x-icon" rel="icon" href="../../img/favicon.png">
  </head>
  <body>
    <div class="rs-wrapper ms-bg-gray">
      <header class="rs-navbar">
        <h1>Flexidx Cutting-Edge MLS/IDX Search for Wordpress</h1>
        <nav>
          <div class="logo">
            <a href="#" title="Flexidx">
              <img src="https://www.idxboost.com/bundles/website/images/logo.png" title="Flexidx" alt="Cutting-Edge MLS/IDX Search for Wordpress">
            </a>
            <button class="ms-hidden-menu-btn">Hidden Menu <span></span></button>
          </div>
          <div class="header-nav">
            
            <div class="user_nav" style="margin-left: auto">
              <a href="javascript:void(0)" title="Harold Gracía" id="user-avatar">
                <span class="gb">4</span>
                <div class="user_avatar">
                  <img src="http://www.viewsonyou.com/img/avatar/Avatar4.png">
                </div>
                <h2>Harold Gracía</h2>
                <span>GARY HENNES REALTORS</span>
              </a>
              <ul id="userList">
                <li><a href="#" title="Leads">Notificatons <span class="gb">4</span></a></li>
                <li><a href="#" title="Leads">Leads</a></li>
                <li><a href="#" title="Filters">Filters</a></li>
                <li><a href="#" title="Listings">Listings</a></li>
                <li><a href="#" title="Account Setup">Account Setup</a></li>
                <li><a href="#" title="Analytics">Analytics</a></li>
                <li><a href="#" title="Log out">Log out</a></li>
              </ul>
            </div>
            <div class="search_nav">
              <button id="help" class="btn-help">Help</button>
              <button id="serch" class="btn-serach">Search</button>
            </div>
          </div>
          <button class="main_menu" id=mainMene>Main Menu <span></span></button>
          <button class="sub_menu" id="subMenu">Sub Menu <span></span></button>
        </nav>
      </header>

      <aside class="rs-sidebar">
        <div class="title-rs-sidebar">Main menu</div>
        <button id="closeMenu">Close</button>
        <ul class="ms-menu-list ms-disable-menu">
          <li><a href="/" title="My Leads" class="item_nav ico-leads">My Leads<span class="gb">173</span></a></li>
          <li>
            <a href="#" title="Marketing" class="item_nav ico-marketing sub-items">Marketing</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="My Bucket">My Buckets</a></li>
              <li><a href="#" title="Drip Campaigns">Drip Campaigns</a></li>
              <li><a href="#" title="Email Templates">Email Templates</a></li>
              <li><a href="#" title="SMS Templates">SMS Templates</a></li>
              <li><a href="#" title="Add Lead">Add Lead</a></li>
              <li><a href="#" title="Hackbox">Hackbox</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="My Listings" class="item_nav ico-listing sub-items">My Listings</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="Exclusive Listings">Exclusive Listings</a></li>
              <li><a href="#" title="Sold Listings">Sold Listings</a></li>
              <li><a href="#" title="Add Listing Details">Add Listing Details</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="Filters" class="item_nav ico-filters sub-items">Filters</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="Map Search Filters">Map Search Filters</a></li>
              <li><a href="#" title="Display Filters">Display Filters</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="Buildings" class="item_nav ico-buildings sub-items">Buildings</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="My Buildings">My Buildings</a></li>
              <li><a href="#" title="Building Groups">Building Groups</a></li>
              <li><a href="#" title="Floorplan Settings">Floorplan Settings</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="Areas" class="item_nav ico-areas sub-items">Areas</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="My Areas">My Areas</a></li>
              <li><a href="#" title="Area Groups">Area Groups</a></li>
              <li><a href="#" title="Floorplan Settings">Floorplan Settings</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="My Account" class="item_nav ico-account sub-items">My Account</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="My Profile">My Profile</a></li>
              <li><a href="#" title="Registration Key">Registration Key</a></li>
              <li><a href="#" title="Change Password">Change Password</a></li>
              <li><a href="#" title="Billing Information">Billing Information</a></li>
              <li><a href="#" title="Social Networks">Social Networks</a></li>
              <li><a href="#" title="Terms & Conditions">Terms & Conditions</a></li>
            </ul>
          </li>

          <li>
            <a href="#" title="Settings" class="item_nav ico-setting sub-items">Settings</a>
            <ul class="sub_item_nav">
              <li><a href="#" title="Cities">Cities</a></li>
              <li><a href="#" title="Display Preferences">Display Preferences</a></li>
              <li><a href="#" title="Registration Settings">Registration Settings</a></li>
              <li><a href="#" title="Analitycs Integration">Analitycs Integration</a></li>
              <li><a href="#" title="CRM Integration">CRM Integration</a></li>
              <li><a href="#" title="Google Maps">Google Maps</a></li>
              <li><a href="#" title="Email Header">Email Header</a></li>
              <li><a href="#" title="Email Sender">Email Sender</a></li>
            </ul>
          </li>
          <li>
            <a class="item_nav ico-tutorial " href="/getting_started" title="IDX Analytics">Tutorials</a>
          </li>
        </ul>
      </aside>

      <div class="rs-content-wrapper ms-crm-page">
        <div class="ms-wrap-widget border-bottom ms-crm-form ms-wrap-form ms-video-property-options">
          <div class="ms-crm-form ms-wrap-form">
            <div class="form-item ms-full">
              <label for="url_custom_video">Video Url</label>
              <input type="text" id="url_video" name="url_custom_video" placeholder="Enter your video url">
            </div>
    
            <div class="form-item ms-full">
              <div class="ms-flex-content">
                <div class="ms-item">
                  <div class="ms-custom-input-file">
                    <input type="file" id="imageInput" accept="image/*">
                    <label for="imageInput" class="ms-btn-file"><i class="crm-ico-camera"></i> Select image</label>
                  </div>
                </div>
                <div class="ms-item" id="reload-btn">
                  <button class="ms-btn-reload" type="button" onclick="reloadThumbnail()"><i class="crm-ico-reload"></i> Reload Preview</button>
                </div>
                <div class="ms-item -flex">
                  <label for="autoplay_video" class="ms-text">Autoplay Video</label>
                  <div class="ms-button-switch">
                    <input type="checkbox" id="autoplay_video">
                    <label for="autoplay_video">
                      <span>on</span>
                      <span>off</span>
                    </label>
                  </div>
                </div>
                <div id="preview-container">
                  <img id="preview" src="" alt="Preview">
                  <button class="delete-btn" onclick="removePreview()" type="button"><i class="crm-ico-ms-trash"></i> Delete</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <script type="text/javascript" src="../../js/jquery-3.1.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../js/select2.min.js"></script>
    <script type="text/javascript" src="../../js/main.js"></script>

    <script type="text/javascript">

      /**********************************************************/

    const imageInput = document.getElementById('imageInput');
		const urlVideo = document.getElementById('url_video');
		const preview = document.getElementById('preview');
		const previewContainer = document.getElementById('preview-container');
		const reloadBtn = document.getElementById('reload-btn');
		const hiddenThumbnail = document.getElementById('hidden_thumbnail_url');
		const hiddenSource = document.getElementById('hidden_source_type');

		imageInput.addEventListener('change', function () {
			const file = this.files[0];
			if (file) {
				const reader = new FileReader();
				reader.onload = function (e) {
					showPreview(e.target.result);
					updateHiddenFields(e.target.result, 'file');
					reloadBtn.style.display = 'none';
				};
				reader.readAsDataURL(file);
			}
		});

		urlVideo.addEventListener('input', async function () {
			const url = this.value.trim();
			const videoInfo = await getVideoThumbnail(url);
			if (videoInfo && videoInfo.thumbnail) {
				showPreview(videoInfo.thumbnail);
				updateHiddenFields(videoInfo.thumbnail, videoInfo.type);
				imageInput.value = "";
				reloadBtn.style.display = 'none';
			} else {
				reloadBtn.style.display = 'none';
				clearHiddenFields(); // Si es URL inválida
			}
		});

		function showPreview(src) {
			preview.src = src;
			previewContainer.style.display = 'inline-block';
		}

		function removePreview() {
			preview.src = "";
			previewContainer.style.display = 'none';
			imageInput.value = "";

			// Mostrar botón de recarga si URL es válida
			checkValidVideoURL(urlVideo.value.trim()).then(isValid => {
				if (isValid) {
					reloadBtn.style.display = 'flex';
				}
			});

			// No limpiamos el campo de URL, pero sí los campos ocultos
			clearHiddenFields();
		}

		async function reloadThumbnail() {
			const url = urlVideo.value.trim();
			const videoInfo = await getVideoThumbnail(url);
			if (videoInfo && videoInfo.thumbnail) {
				showPreview(videoInfo.thumbnail);
				updateHiddenFields(videoInfo.thumbnail, videoInfo.type);
				reloadBtn.style.display = 'none';
			}
		}

		function extractYouTubeID(url) {
			const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:watch\?v=|embed\/|v\/)|youtu\.be\/)([\w-]{11})/;
			const match = url.match(regex);
			return match ? match[1] : null;
		}

		async function getVimeoThumbnail(vimeoUrl) {
			try {
				const response = await fetch(`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(vimeoUrl)}`);
				if (!response.ok) throw new Error('No se pudo obtener thumbnail de Vimeo');
				const data = await response.json();
				return data.thumbnail_url;
			} catch (error) {
				return null;
			}
		}

		async function getVideoThumbnail(url) {
			const youtubeId = extractYouTubeID(url);
			if (youtubeId) {
				return { type: 'youtube', thumbnail: `https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg` };
			} else if (/vimeo\.com/.test(url)) {
				const vimeoThumb = await getVimeoThumbnail(url);
				if (vimeoThumb) {
					return { type: 'vimeo', thumbnail: vimeoThumb };
				}
			}
			return null;
		}

		async function checkValidVideoURL(url) {
			const info = await getVideoThumbnail(url);
			return !!(info && info.thumbnail);
		}

		function updateHiddenFields(thumbnailUrl, sourceType) {
			hiddenThumbnail.value = thumbnailUrl;
			hiddenSource.value = sourceType;
		}

		function clearHiddenFields() {
			hiddenThumbnail.value = "";
			hiddenSource.value = "";
		}

    /**********************************************************/

    </script>
  </body>
</html>